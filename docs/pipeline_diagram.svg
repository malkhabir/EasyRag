<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="640" viewBox="0 0 1200 640">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="6" refY="5" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#2b7a78" />
    </marker>
    <style>
      .box { fill:#fff; stroke:#2b7a78; stroke-width:2; rx:6; }
      .title { font: 700 14px/1.1 Arial, Helvetica, sans-serif; fill:#054f4d }
      .text { font: 13px/1.2 Arial, Helvetica, sans-serif; fill:#042f2e }
      .note { font: 12px/1.2 Arial, Helvetica, sans-serif; fill:#13504d }
    </style>
  </defs>

  <!-- Boxes -->
  <rect class="box" x="24" y="28" width="210" height="80"/>
  <text class="title" x="36" y="52">PDF (vector)</text>
  <text class="text" x="36" y="72">original file (pages, points)</text>

  <rect class="box" x="270" y="20" width="200" height="100"/>
  <text class="title" x="286" y="48">Rasterize</text>
  <text class="text" x="286" y="72">page → image (PNG, 300 DPI)</text>

  <rect class="box" x="520" y="14" width="220" height="120"/>
  <text class="title" x="540" y="44">TADetect</text>
  <text class="text" x="540" y="68">fast region proposals (high recall)</text>
  <text class="text" x="540" y="88">returns coarse boxes (x,y,w,h)_px</text>

  <rect class="box" x="520" y="160" width="220" height="120"/>
  <text class="title" x="540" y="188">Crop & DIT</text>
  <text class="text" x="540" y="212">crop proposals → DIT (refine)</text>
  <text class="text" x="540" y="232">precise cell boxes (relative to crop)_px</text>

  <rect class="box" x="800" y="70" width="340" height="220"/>
  <text class="title" x="820" y="98">Post-process</text>
  <text class="text" x="820" y="122">expand/pad boxes • IOU filter • merge/clean</text>
  <text class="text" x="820" y="146">map coords back to PDF points</text>
  <text class="text" x="820" y="170">serialize tables → CSV/JSON/Markdown</text>
  <text class="text" x="820" y="194">generate embeddings (row/cell/table)</text>

  <rect class="box" x="520" y="320" width="620" height="120"/>
  <text class="title" x="540" y="348">Indexing & Document Object</text>
  <text class="text" x="540" y="372">create embedding records with metadata:</text>
  <text class="text" x="540" y="392">{ text, source, page, coords_pdf, coords_px, table_id, row_id }</text>

  <!-- Arrows -->
  <line x1="234" y1="68" x2="270" y2="68" stroke="#2b7a78" stroke-width="3" marker-end="url(#arrow)" />
  <line x1="470" y1="70" x2="520" y2="70" stroke="#2b7a78" stroke-width="3" marker-end="url(#arrow)" />
  <line x1="620" y1="134" x2="620" y2="160" stroke="#2b7a78" stroke-width="3" marker-end="url(#arrow)" />
  <line x1="740" y1="70" x2="800" y2="70" stroke="#2b7a78" stroke-width="3" marker-end="url(#arrow)" />
  <line x1="960" y1="190" x2="960" y2="320" stroke="#2b7a78" stroke-width="3" marker-end="url(#arrow)" />

  <!-- Mapping math block -->
  <rect x="24" y="520" width="1160" height="96" rx="6" fill="#f7fffd" stroke="#bfeeea" />
  <text class="title" x="38" y="546">Coordinate mapping (pixel ↔ PDF points)</text>
  <text class="note" x="38" y="568">Let image_width_px, image_height_px be raster size; pdf_width_pt, pdf_height_pt be page size in points (1 pt = 1/72 in).</text>
  <text class="note" x="38" y="588">scale_x = pdf_width_pt / image_width_px</text>
  <text class="note" x="38" y="606">scale_y = pdf_height_pt / image_height_px</text>
  <text class="note" x="420" y="588">x_pdf = x_px * scale_x</text>
  <text class="note" x="420" y="606">y_pdf = pdf_height_pt - (y_px * scale_y)  (invert y if pixel origin is top-left)</text>

  <!-- footer note -->
  <text class="note" x="36" y="636">Diagram: PDF → raster → TADetect → DIT → post-process → map coords → parse → index. EasyRag stores both pixel and PDF coordinates for UI overlays + exact PDF highlighting.</text>
</svg>
